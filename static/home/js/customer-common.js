let yenova_data = {
    branch: [
        { "id": "1", "name": "北京", "domain": "bjhd2" },
        { "id": "2", "name": "慈溪", "domain": "cixi" },
        { "id": "3", "name": "郑州", "domain": "zz" },
        { "id": "4", "name": "宁波", "domain": "nb" },
        { "id": "5", "name": "西安", "domain": "xa" },
        { "id": "6", "name": "天津", "domain": "tj" },
        { "id": "7", "name": "贵阳", "domain": "gy" },
        { "id": "9", "name": "兰州", "domain": "lz" },
        { "id": "10", "name": "哈尔滨", "domain": "heb" },
        { "id": "11", "name": "济南", "domain": "jn" },
        { "id": "13", "name": "重庆", "domain": "cqhd" },
        { "id": "14", "name": "石家庄", "domain": "sjz" },
        { "id": "15", "name": "承德", "domain": "chengde2" },
        { "id": "16", "name": "包头", "domain": "baotou2" },
        { "id": "17", "name": "南通", "domain": "nantong2" },
        { "id": "18", "name": "德州", "domain": "dezhou2" },
        { "id": "19", "name": "济宁", "domain": "jining2" },
        { "id": "20", "name": "青岛", "domain": "qd" },
        { "id": "21", "name": "镇江", "domain": "zhenjiang2" },
        { "id": "22", "name": "成都", "domain": "cd" },
        { "id": "23", "name": "南阳", "domain": "nanyang" },
        { "id": "24", "name": "南京", "domain": "nj" },
        { "id": "26", "name": "南昌", "domain": "nc" },
        { "id": "27", "name": "秦皇岛", "domain": "qhd2" },
        { "id": "28", "name": "合肥", "domain": "hf" },
        { "id": "29", "name": "大连", "domain": "dl" },
        { "id": "30", "name": "武汉", "domain": "wh" },
        { "id": "31", "name": "唐山", "domain": "tangshan" },
        { "id": "33", "name": "沈阳", "domain": "sy" },
        { "id": "34", "name": "乌鲁木齐", "domain": "wlmq" },
        { "id": "35", "name": "太原", "domain": "ty" },
        { "id": "36", "name": "通辽", "domain": "tongliao2" },
        { "id": "37", "name": "潍坊", "domain": "wf" },
        { "id": "39", "name": "齐齐哈尔", "domain": "qq2" },
        { "id": "40", "name": "商丘", "domain": "shangqiu2" },
        { "id": "42", "name": "连云港", "domain": "lyg2" },
        { "id": "44", "name": "开封", "domain": "kaifeng2" },
        { "id": "46", "name": "马鞍山", "domain": "maanshan2" },
        { "id": "50", "name": "渭南", "domain": "weinan2" },
        { "id": "52", "name": "西宁", "domain": "xining" },
        { "id": "53", "name": "保定", "domain": "baoding2" },
        { "id": "54", "name": "苏州", "domain": "suzhou" },
        { "id": "55", "name": "淄博", "domain": "zibo" },
        { "id": "56", "name": "乐山", "domain": "leshan2" },
        { "id": "57", "name": "徐州", "domain": "xuzhou2" },
        { "id": "58", "name": "邯郸", "domain": "handan" },
        { "id": "59", "name": "周口", "domain": "zhoukou2" },
        { "id": "61", "name": "锦州", "domain": "jinzhou" },
        { "id": "63", "name": "凯里", "domain": "kaili2" },
        { "id": "66", "name": "咸宁", "domain": "xianning2" },
        { "id": "67", "name": "焦作", "domain": "jiaozuo2" },
        { "id": "69", "name": "平顶山", "domain": "pds" },
        { "id": "70", "name": "淮安", "domain": "huaian" },
        { "id": "71", "name": "临沂", "domain": "linyi" },
        { "id": "72", "name": "烟台", "domain": "yantai2" },
        { "id": "73", "name": "任丘", "domain": "renqiu2" },
        { "id": "74", "name": "西双版纳", "domain": "xsbn2" },
        { "id": "77", "name": "长沙", "domain": "cs2" },
        { "id": "82", "name": "宜宾", "domain": "yibin" },
        { "id": "83", "name": "呼和浩特", "domain": "hhht2" },
        { "id": "85", "name": "临夏", "domain": "linxia2" },
        { "id": "87", "name": "南充", "domain": "nanchong2" },
        { "id": "90", "name": "景德镇", "domain": "jingdezhen2" },
        { "id": "93", "name": "自贡", "domain": "zigong2" },
        { "id": "96", "name": "黄石", "domain": "huangshi2" },
        { "id": "97", "name": "福州", "domain": "fuzhou2" },
        { "id": "98", "name": "海口", "domain": "haikou2" },
        { "id": "100", "name": "遂宁", "domain": "suining2" },
        { "id": "102", "name": "湖州", "domain": "huzhou2" },
        { "id": "104", "name": "无锡", "domain": "wuxi2" },
        { "id": "106", "name": "汉中", "domain": "hanzhong2" },
        { "id": "107", "name": "晋城", "domain": "jincheng2" },
        { "id": "110", "name": "乌兰察布", "domain": "wlcb2" },
        { "id": "112", "name": "东营", "domain": "dongying" },
        { "id": "114", "name": "仙桃", "domain": "xiantao2" },
        { "id": "115", "name": "沧州", "domain": "cangzhou2" },
        { "id": "120", "name": "三亚", "domain": "sanya2" },
        { "id": "121", "name": "襄阳", "domain": "xiangfan2" },
        { "id": "122", "name": "伊宁", "domain": "yining2" },
        { "id": "124", "name": "常德", "domain": "changde2" },
        { "id": "125", "name": "全国", "domain": "jt" },
        { "id": "126", "name": "都匀", "domain": "duyun2" },
        { "id": "127", "name": "盐城", "domain": "yancheng" },
        { "id": "128", "name": "宿迁", "domain": "suqian2" },
        { "id": "130", "name": "张家口", "domain": "zhangjiakou2" },
        { "id": "131", "name": "佛山", "domain": "foshan2" },
        { "id": "132", "name": "洛阳", "domain": "luoyang2" },
        { "id": "134", "name": "安顺", "domain": "anshun2" },
        { "id": "135", "name": "六安", "domain": "liuan2" },
        { "id": "136", "name": "威海", "domain": "weihai2" },
        { "id": "137", "name": "长春", "domain": "changchun2" },
        { "id": "138", "name": "广安", "domain": "guangan2" },
        { "id": "140", "name": "克拉玛依", "domain": "klmy2" },
        { "id": "144", "name": "张掖", "domain": "zhangye2" },
        { "id": "146", "name": "常州", "domain": "changzhou2" },
        { "id": "147", "name": "南宁", "domain": "nanning" },
        { "id": "148", "name": "安阳", "domain": "anyang2" },
        { "id": "149", "name": "品德装饰", "domain": "pinde2" },
        { "id": "151", "name": "麻城", "domain": "macheng2" },
        { "id": "152", "name": "信息流", "domain": "dsp" },
        { "id": "153", "name": "北京SEM部分", "domain": "" },
        { "id": "154", "name": "资阳", "domain": "ziyang2" },
        { "id": "155", "name": "十堰", "domain": "shiyan2" },
        { "id": "156", "name": "定西", "domain": "dingxi2" },
        { "id": "157", "name": "衡水", "domain": "hengshui2" },
        { "id": "158", "name": "昭通", "domain": "zhaotong2" },
        { "id": "159", "name": "通州", "domain": "nttongzhou2" },
        { "id": "160", "name": "邢台", "domain": "xingtai2" },
        { "id": "161", "name": "保定全包圆", "domain": "bdqby" },
        { "id": "162", "name": "北京全包圆", "domain": "bjqby" },
        { "id": "163", "name": "楚雄", "domain": "chuxiong2" },
        { "id": "165", "name": "朝阳", "domain": "chaoyang2" },
        { "id": "166", "name": "吉林", "domain": "jilin2" },
        { "id": "167", "name": "荆州", "domain": "jingzhou2" },
        { "id": "168", "name": "固原", "domain": "guyuan2" },
        { "id": "169", "name": "榆林", "domain": "yulin2" },
        { "id": "170", "name": "沭阳", "domain": "shuyang2" },
        { "id": "171", "name": "西昌", "domain": "xichang2" },
        { "id": "172", "name": "丽水", "domain": "lishui2" },
        { "id": "280", "name": "北京迷住", "domain": "bjmz" },
        { "id": "281", "name": "滨州", "domain": "binzhou2" },
    ],
    getBranch: function (obj) {
        let attr;
        if (obj.hasOwnProperty('id')) {

            attr = 'id';
        }
        if (obj.hasOwnProperty('name')) {
            attr = 'name';
        }
        if (obj.hasOwnProperty('domain')) {
            attr = 'domain';
        }
        //console.log(attr);
        let result = null;
        for (let i = 0, length = this.branch.length; i < length; i++) {
            if (this.branch[i][attr] === obj[attr]) {
                result = this.branch[i];
                break;
            }
        }
        return result;
    }
};

let aboutUrl = {
    getCurrentRequestValue: function (parameter) {
        let reg = new RegExp("(^|&)" + parameter + "=([^&]*)(&|$)", "i");
        let r = window.location.search.substr(1).match(reg);
        if (r !== null) {
            return unescape(r[2]);
        }
        return '';
    },
    getCurrentRequestObject: function () {
        let url = location.search;
        let theRequest = new Object();
        if (url.indexOf("?") !== -1) {
            let str = url.substr(1);
            strs = str.split("&");
            for (let i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }
};
let aboutCookie = {
    setCookie: function (name, value, hours) {
        let d = new Date();
        d.setTime(d.getTime() + hours * 3600 * 1000);
        document.cookie = name + '=' + value + '; expires=' + d.toGMTString();
    },
    getCookie: function (name) {
        let arr = document.cookie.split('; ');
        for (let i = 0; i < arr.length; i++) {
            let temp = arr[i].split('=');
            if (temp[0] === name) {
                return temp[1];
            }
        }
        return null;
    },
    removeCookie: function (name) {
        let d = new Date();
        d.setTime(d.getTime() - 10000);
        document.cookie = name + '=1; expires=' + d.toGMTString();
    }
};
let customer = {
    ms: '',
    bid: '',            //分公司Id
    fptid: '',
    name: '',           //客户名称
    phoneNumber: '',    //电话号码
    email: '',          //邮箱
    residentialName: '',//小区名
    squareMeters: '',   //建筑面积
    channel: '',        //了解渠道
    ck: '',             //渠道关键字
    url: '',            //url地址
    userId: '',         //关联推广员id
    remark: ''          //备注
};
/* 报名信息提交对象及页面元素初始化 */
let customerInit = {
    showCity: function () {
        if (customer.bid) {
            let $citys = $('.show-city');
            if ($citys.length > 0) {
                let branch = yenova_data.getBranch({ 'id': customer.bid });
                if (branch) {
                    $citys.html(branch['name']);
                }
            }
        }
    },
    init: function () {
        customerInit.initDate();
        customerInit.initByUrl();
        customerInit.initByCookie();
        customerInit.initByLocation();
        customerInit.initElement();
    },
    //初始化日期
    initDate: function () {
        let $elements = $('.show-date');
        if ($elements.length > 0) {
            let month = new Date().getMonth() + 1;
            let lastDay = 31;
            switch (month) {
                case 2:
                    lastDay = 28;
                    break;
                case 4:
                case 6:
                case 9:
                case 11:
                    lastDay = 30;
                    break;
            }
            $elements.html(month + '月1日-' + month + '月' + lastDay + '日');
        }
    },

    //根据url初始化
    initByUrl: function () {
        //url参数处理
        customer.url = location.href;
        customer.bid = $('#body-branchId').val();

        let kvs = aboutUrl.getCurrentRequestObject();
        for (let k in kvs) {
            if (kvs[k]) {
                if (customer.hasOwnProperty(k)) {
                    customer[k] = kvs[k];
                }
            }
        }
        //bid处理（domain -> id）
        if (customer.bid && isNaN(customer.bid)) {
            let branch = yenova_data.getBranch({ 'domain': customer.bid });
            if (branch) {
                customer.bid = branch['id'];
            }
        }
        //cookie
        if (customer.ck) {
            aboutCookie.removeCookie('yenova-ck');
            aboutCookie.setCookie('yenova-ck', customer.ck);
        }
        if (customer.userId) {
            aboutCookie.removeCookie('yenova-userId');
            aboutCookie.setCookie('yenova-userId', customer.userId);
        }
       
        //显示城市
        customerInit.showCity();

        console.log('-------initByUrl----------');
        console.log(customer);
    },

    //根据cookie初始化 ck和userId
    initByCookie: function () {
        if (!customer.ck) {
            customer.ck = aboutCookie.getCookie('yenova-ck');
        }
        if (!customer.userId) {
            customer.userId = aboutCookie.getCookie('yenova-userId');
        }
        //console.log('-------initByCookie----------');
        //console.log(customer);
    },

    //百度定位
    initByLocation() {
        if (!customer.bid) {
            let myCity = new BMap.Geolocation();
            myCity.getCurrentPosition(function (result) {
                if (this.getStatus() === BMAP_STATUS_SUCCESS) {
                    let citystr = result.address.city.replace('市', '');
                    let branch = yenova_data.getBranch({ 'name': citystr });
                    if (branch) {
                        customer.bid = branch['id'];
                        customerInit.showCity();
                        //console.log('-------initByLocation----------');
                        //console.log(customer);
                    }
                }
            });
        }
    },

    //初始化元素
    initElement: function () {
        if (customer.ms === 'bdocpc' || customer.ck === 'bdpz-tpzq') {
            //百度ocpc模式代码
            console.log('load bdocpc');
            createScript_BaiduOCPC();
        }
        if (customer.ms === 'gdtocpc') {
            //广点通ocpc模式代码
        }
        //百度统计代码
        createScript_BaiduTongji();
        if ($("[name='branchId'],[name='BranchId']").val() === "29") {
            $("form").append("<p style='text-align: center;color: #fff;padding-top: 10px;'>最终解释权归业之峰所有</p>");
        }
    }
};

/* 通用处理js原型扩展 */
String.prototype.isMobilePhoneNumber = function () {
    var isPhone = /^0\d{2,3}-?\d{7,8}$/;
    var isMob = /^1\d{10}$/;
    return isMob.test(this) || isPhone.test(this);
};
//房屋面积 1-999
String.prototype.isHouseArea = function () {
    var reg = new RegExp('^[1-9]{1}[0-9]{0,2}$');
    return reg.test(this);
};

/* 表单提交，仅用于customer对象 */
$(".submit").click(function () {
    let $form = $(this).parent("form");
    let $elements = $form.find('input[type!="button"],textarea,select');
    $elements.each(function (index, element) {
        let name = $(element).attr('name');
        let val = $(element).val();
        if (customer.hasOwnProperty(name)) {
            customer[name] = val;
        }
    });
    //姓名非空验证
    let $inputName = $elements.filter('input[name="name"]');
    if ($inputName.length > 0 && $inputName.val() === '') {
        alert('请输入姓名');
        return;
    }
    //电话号码格式验证
    let $inputPhone = $elements.filter('input[name="phoneNumber"]');
    if ($inputPhone.length > 0 && !$inputPhone.val().isMobilePhoneNumber()) {
        alert('手机号码格式不正确');
        return;
    }
    //备注处理（几室几厅几卫）
    let $targetSel = $form.find('select[class*="remark"]');
    if ($targetSel.length > 0) {
        customer.remark = '';
        $targetSel.each(function (index, element) {
            customer.remark += $(element).val();
        });
    }
    console.log('ajax请求参数');
    console.log(customer);
    let urlHead = document.location.protocol === 'http:' ? 'http:' : 'https:';
    $.ajax({
        type: 'post',
        url: urlHead + '//admin.yzf.com.cn/api/RegistrationAPI/Insert',
        data: {
            'name': customer.name,
            'phoneNumber': customer.phoneNumber,
            'email': customer.email,
            'residentialName': customer.residentialName,
            'squareMeters': customer.squareMeters,
            'channel': customer.channel,
            'ck': customer.ck,
            'url': customer.url,
            'userId': customer.userId,
            'branchId': customer.bid,
            'adUserId': customer.fptid,
            'remark': customer.remark
        },
        success: function (json) {
            console.log('ajax返回结果');
            console.log(json);
            if (json.Sucess) {
                if (customer.ms === 'bdocpc' || customer.ck === 'bdpz-tpzq') {
                    //window._agl && window._agl.push(['track', ['success', { t: 3 }]]);
                    //_hmt.push(['_trackEvent', 'Click', 'Order', 'success', 1]);
                }
                alert("恭喜您，报名成功");
            }
            else {
                alert("同一号码只能报名一次");
            }
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {
            alert(textStatus);
        }
    });
});

/* 追加百度统计代码到head
function createScript_BaiduTongji() {
    if (typeof _hmt === "undefined") {
        let str = "    <script data-mk=\"pc信息流流量统计\">\n";
        str += "        var _hmt = _hmt || [];\n";
        str += "        (function () {\n";
        str += "            var hm = document.createElement(\"script\");\n";
        str += "            hm.src = \"https://hm.baidu.com/hm.js?cf4e7539fd6a59c1258ac97ea762b62f\";\n";
        str += "            var s = document.getElementsByTagName(\"script\")[0];\n";
        str += "            s.parentNode.insertBefore(hm, s);\n";
        str += "        })();\n";
        str += "    </script>\n";
        $('head').append(str);
    }

}
*/

/* 追加百度ocpc代码到head
function createScript_BaiduOCPC() {
    let str = "    <script>\n";
    str += "        window._agl = window._agl || [];\n";
    str += "        (function () {\n";
    str += "            _agl.push(\n";
    str += "                ['production', '_f7L2XwGXjyszb4d1e2oxPybgD']\n";
    str += "            );\n";
    str += "            (function () {\n";
    str += "                var agl = document.createElement('script');\n";
    str += "                agl.type = 'text/javascript';\n";
    str += "                agl.async = true;\n";
    str += "                agl.src = 'https://fxgate.baidu.com/angelia/fcagl.js?production=_f7L2XwGXjyszb4d1e2oxPybgD';\n";
    str += "                var s = document.getElementsByTagName('script')[0];\n";
    str += "                s.parentNode.insertBefore(agl, s);\n";
    str += "            })();\n";
    str += "        })();\n";
    str += "    </script>\n";
    $('head').append(str);
}
*/
/*y页面初始化*/
customerInit.init();