var arr = {};
arr["bjhd2"] = { id: 1, name: '北京' };
arr["cixi"] = { id: 2, name: '慈溪' };
arr["zz"] = { id: 3, name: '郑州' };
arr["nb"] = { id: 4, name: '宁波' };
arr["xa"] = { id: 5, name: '西安' };
arr["tj"] = { id: 6, name: '天津' };
arr["gy"] = { id: 7, name: '贵阳' };
arr["lz"] = { id: 9, name: '兰州' };
arr["heb"] = { id: 10, name: '哈尔滨' };
arr["jn"] = { id: 11, name: '济南' };
arr["cqhd"] = { id: 13, name: '重庆' };
arr["sjz"] = { id: 14, name: '石家庄' };
arr["chengde"] = { id: 15, name: '承德' };
arr["baotou"] = { id: 16, name: '包头' };
arr["nantong"] = { id: 17, name: '南通' };
arr["dezhou"] = { id: 18, name: '德州' };
arr["jining"] = { id: 19, name: '济宁' };
arr["qd"] = { id: 20, name: '青岛' };
arr["zhenjiang"] = { id: 21, name: '镇江' };
arr["cd"] = { id: 22, name: '成都' };
arr["nanyang"] = { id: 23, name: '南阳' };
arr["nj"] = { id: 24, name: '南京' };
arr["nc"] = { id: 26, name: '南昌' };
arr["qhd"] = { id: 27, name: '秦皇岛' };
arr["hf"] = { id: 28, name: '合肥' };
arr["dl"] = { id: 29, name: '大连' };
arr["wh"] = { id: 30, name: '武汉' };
arr["tangshan"] = { id: 31, name: '唐山' };
arr["sy"] = { id: 33, name: '沈阳' };
arr["wlmq"] = { id: 34, name: '乌鲁木齐' };
arr["ty"] = { id: 35, name: '太原' };
arr["tongliao"] = { id: 36, name: '通辽' };
arr["wf"] = { id: 37, name: '潍坊' };
arr["qq"] = { id: 39, name: '齐齐哈尔' };
arr["shangqiu"] = { id: 40, name: '商丘' };
arr["lyg"] = { id: 42, name: '连云港' };
arr["kaifeng"] = { id: 44, name: '开封' };
arr["maanshan"] = { id: 46, name: '马鞍山' };
arr["weinan"] = { id: 50, name: '渭南' };
arr["xining"] = { id: 52, name: '西宁' };
arr["baoding"] = { id: 53, name: '保定' };
arr["suzhou"] = { id: 54, name: '苏州' };
arr["zibo"] = { id: 55, name: '淄博' };
arr["leshan"] = { id: 56, name: '乐山' };
arr["xuzhou"] = { id: 57, name: '徐州' };
arr["handan"] = { id: 58, name: '邯郸' };
arr["zhoukou"] = { id: 59, name: '周口' };
arr["jinzhou"] = { id: 61, name: '锦州' };
arr["kaili"] = { id: 63, name: '凯里' };
arr["xianning"] = { id: 66, name: '咸宁' };
arr["jiaozuo"] = { id: 67, name: '焦作' };
arr["pds"] = { id: 69, name: '平顶山' };
arr["huaian"] = { id: 70, name: '淮安' };
arr["linyi"] = { id: 71, name: '临沂' };
arr["yantai"] = { id: 72, name: '烟台' };
arr["renqiu"] = { id: 73, name: '任丘' };
arr["xsbn"] = { id: 74, name: '西双版纳' };
arr["cs"] = { id: 77, name: '长沙' };
arr["yibin"] = { id: 82, name: '宜宾' };
arr["hhht"] = { id: 83, name: '呼' };
arr["linxia"] = { id: 85, name: '临夏' };
arr["nanchong"] = { id: 87, name: '南充' };
arr["jingdezhen"] = { id: 90, name: '景德镇' };
arr["zigong"] = { id: 93, name: '自贡' };
arr["huangshi"] = { id: 96, name: '黄石' };
arr["fuzhou"] = { id: 97, name: '福州' };
arr["haikou"] = { id: 98, name: '海口' };
arr["suining"] = { id: 100, name: '遂宁' };
arr["huzhou"] = { id: 102, name: '湖州' };
arr["wuxi"] = { id: 104, name: '无锡' };
arr["hanzhong"] = { id: 106, name: '汉中' };
arr["jincheng"] = { id: 107, name: '晋城' };
arr["cdhuichao"] = { id: 108, name: '成都汇巢别墅' };
arr["huichao"] = { id: 109, name: '北京汇巢别墅' };
arr["wlcb"] = { id: 110, name: '乌兰察布' };
arr["dongying"] = { id: 112, name: '东营' };
arr["xiantao"] = { id: 114, name: '仙桃' };
arr["cangzhou"] = { id: 115, name: '沧州' };
arr["sanya"] = { id: 120, name: '三亚' };
arr["xiangfan"] = { id: 121, name: '襄阳' };
arr["yining"] = { id: 122, name: '伊宁' };
arr["changde"] = { id: 124, name: '常德' };
arr["jt"] = { id: 125, name: '集团' };
arr["duyun"] = { id: 126, name: '都匀' };
arr["yancheng"] = { id: 127, name: '盐城' };
arr["suqian"] = { id: 128, name: '宿迁' };
arr["cd2"] = { id: 129, name: '成都诺华装饰' };
arr["zhangjiakou"] = { id: 130, name: '张家口' };
arr["foshan"] = { id: 131, name: '佛山' };
arr["luoyang"] = { id: 132, name: '洛阳' };
arr["anshun"] = { id: 134, name: '安顺' };
arr["liuan"] = { id: 135, name: '六安' };
arr["weihai"] = { id: 136, name: '威海' };
arr["changchun"] = { id: 137, name: '长春' };
arr["guangan"] = { id: 138, name: '广安' };
arr["klmy"] = { id: 140, name: '克拉玛依' };
arr[""] = { id: 143, name: '石家庄网销' };
arr["zhangye"] = { id: 144, name: '张掖' };
arr["changzhou"] = { id: 146, name: '常州' };
arr["nanning"] = { id: 147, name: '南宁' };
arr["anyang"] = { id: 148, name: '安阳' };
arr["bdqby"] = { id: 161, name: '保定' };
arr["bjqby"] = { id: 162, name: '北京' };

var arr2 = {};
arr2["北京"] = { id: 1, name: '北京', domain: 'bjhd2' };
arr2["慈溪"] = { id: 2, name: '慈溪', domain: 'cixi' };
arr2["郑州"] = { id: 3, name: '郑州', domain: 'zz' };
arr2["宁波"] = { id: 4, name: '宁波', domain: 'nb' };
arr2["西安"] = { id: 5, name: '西安', domain: 'xa' };
arr2["天津"] = { id: 6, name: '天津', domain: 'tj' };
arr2["贵阳"] = { id: 7, name: '贵阳', domain: 'gy' };
arr2["兰州"] = { id: 9, name: '兰州', domain: 'lz' };
arr2["哈尔滨"] = { id: 10, name: '哈尔滨', domain: 'heb' };
arr2["济南"] = { id: 11, name: '济南', domain: 'jn' };
arr2["重庆"] = { id: 13, name: '重庆', domain: 'cqhd' };
arr2["石家庄"] = { id: 14, name: '石家庄', domain: 'sjz' };
arr2["承德"] = { id: 15, name: '承德', domain: 'chengde' };
arr2["包头"] = { id: 16, name: '包头', domain: 'baotou' };
arr2["南通"] = { id: 17, name: '南通', domain: 'nantong' };
arr2["德州"] = { id: 18, name: '德州', domain: 'dezhou' };
arr2["济宁"] = { id: 19, name: '济宁', domain: 'jining' };
arr2["青岛"] = { id: 20, name: '青岛', domain: 'qd' };
arr2["镇江"] = { id: 21, name: '镇江', domain: 'zhenjiang' };
arr2["成都"] = { id: 22, name: '成都', domain: 'cd' };
arr2["南阳"] = { id: 23, name: '南阳', domain: 'nanyang' };
arr2["南京"] = { id: 24, name: '南京', domain: 'nj' };
arr2["南昌"] = { id: 26, name: '南昌', domain: 'nc' };
arr2["秦皇岛"] = { id: 27, name: '秦皇岛', domain: 'qhd' };
arr2["合肥"] = { id: 28, name: '合肥', domain: 'hf' };
arr2["大连"] = { id: 29, name: '大连', domain: 'dl' };
arr2["武汉"] = { id: 30, name: '武汉', domain: 'wh' };
arr2["唐山"] = { id: 31, name: '唐山', domain: 'tangshan' };
arr2["沈阳"] = { id: 33, name: '沈阳', domain: 'sy' };
arr2["乌鲁木齐"] = { id: 34, name: '乌鲁木齐', domain: 'wlmq' };
arr2["太原"] = { id: 35, name: '太原', domain: 'ty' };
arr2["通辽"] = { id: 36, name: '通辽', domain: 'tongliao' };
arr2["潍坊"] = { id: 37, name: '潍坊', domain: 'wf' };
arr2["齐齐哈尔"] = { id: 39, name: '齐齐哈尔', domain: 'qq' };
arr2["商丘"] = { id: 40, name: '商丘', domain: 'shangqiu' };
arr2["连云港"] = { id: 42, name: '连云港', domain: 'lyg' };
arr2["开封"] = { id: 44, name: '开封', domain: 'kaifeng' };
arr2["马鞍山"] = { id: 46, name: '马鞍山', domain: 'maanshan' };
arr2["渭南"] = { id: 50, name: '渭南', domain: 'weinan' };
arr2["西宁"] = { id: 52, name: '西宁', domain: 'xining' };
arr2["保定"] = { id: 53, name: '保定', domain: 'baoding' };
arr2["苏州"] = { id: 54, name: '苏州', domain: 'suzhou' };
arr2["淄博"] = { id: 55, name: '淄博', domain: 'zibo' };
arr2["乐山"] = { id: 56, name: '乐山', domain: 'leshan' };
arr2["徐州"] = { id: 57, name: '徐州', domain: 'xuzhou' };
arr2["邯郸"] = { id: 58, name: '邯郸', domain: 'handan' };
arr2["周口"] = { id: 59, name: '周口', domain: 'zhoukou' };
arr2["锦州"] = { id: 61, name: '锦州', domain: 'jinzhou' };
arr2["凯里"] = { id: 63, name: '凯里', domain: 'kaili' };
arr2["咸宁"] = { id: 66, name: '咸宁', domain: 'xianning' };
arr2["焦作"] = { id: 67, name: '焦作', domain: 'jiaozuo' };
arr2["平顶山"] = { id: 69, name: '平顶山', domain: 'pds' };
arr2["淮安"] = { id: 70, name: '淮安', domain: 'huaian' };
arr2["临沂"] = { id: 71, name: '临沂', domain: 'linyi' };
arr2["烟台"] = { id: 72, name: '烟台', domain: 'yantai' };
arr2["任丘"] = { id: 73, name: '任丘', domain: 'renqiu' };
arr2["西双版纳"] = { id: 74, name: '西双版纳', domain: 'xsbn' };
arr2["长沙"] = { id: 77, name: '长沙', domain: 'cs' };
arr2["宜宾"] = { id: 82, name: '宜宾', domain: 'yibin' };
arr2["呼"] = { id: 83, name: '呼', domain: 'hhht' };
arr2["临夏"] = { id: 85, name: '临夏', domain: 'linxia' };
arr2["南充"] = { id: 87, name: '南充', domain: 'nanchong' };
arr2["景德镇"] = { id: 90, name: '景德镇', domain: 'jingdezhen' };
arr2["自贡"] = { id: 93, name: '自贡', domain: 'zigong' };
arr2["黄石"] = { id: 96, name: '黄石', domain: 'huangshi' };
arr2["福州"] = { id: 97, name: '福州', domain: 'fuzhou' };
arr2["海口"] = { id: 98, name: '海口', domain: 'haikou' };
arr2["遂宁"] = { id: 100, name: '遂宁', domain: 'suining' };
arr2["湖州"] = { id: 102, name: '湖州', domain: 'huzhou' };
arr2["无锡"] = { id: 104, name: '无锡', domain: 'wuxi' };
arr2["汉中"] = { id: 106, name: '汉中', domain: 'hanzhong' };
arr2["晋城"] = { id: 107, name: '晋城', domain: 'jincheng' };
arr2["乌兰察布"] = { id: 110, name: '乌兰察布', domain: 'wlcb' };
arr2["东营"] = { id: 112, name: '东营', domain: 'dongying' };
arr2["仙桃"] = { id: 114, name: '仙桃', domain: 'xiantao' };
arr2["沧州"] = { id: 115, name: '沧州', domain: 'cangzhou' };
arr2["三亚"] = { id: 120, name: '三亚', domain: 'sanya' };
arr2["襄阳"] = { id: 121, name: '襄阳', domain: 'xiangfan' };
arr2["伊宁"] = { id: 122, name: '伊宁', domain: 'yining' };
arr2["常德"] = { id: 124, name: '常德', domain: 'changde' };
arr2["都匀"] = { id: 126, name: '都匀', domain: 'duyun' };
arr2["盐城"] = { id: 127, name: '盐城', domain: 'yancheng' };
arr2["宿迁"] = { id: 128, name: '宿迁', domain: 'suqian' };
arr2["张家口"] = { id: 130, name: '张家口', domain: 'zhangjiakou' };
arr2["佛山"] = { id: 131, name: '佛山', domain: 'foshan' };
arr2["洛阳"] = { id: 132, name: '洛阳', domain: 'luoyang' };
arr2["安顺"] = { id: 134, name: '安顺', domain: 'anshun' };
arr2["六安"] = { id: 135, name: '六安', domain: 'liuan' };
arr2["威海"] = { id: 136, name: '威海', domain: 'weihai' };
arr2["长春"] = { id: 137, name: '长春', domain: 'changchun' };
arr2["广安"] = { id: 138, name: '广安', domain: 'guangan' };
arr2["克拉玛依"] = { id: 140, name: '克拉玛依', domain: 'klmy' };
arr2["张掖"] = { id: 144, name: '张掖', domain: 'zhangye' };
arr2["常州"] = { id: 146, name: '常州', domain: 'changzhou' };
arr2["南宁"] = { id: 147, name: '南宁', domain: 'nanning' };
arr2["安阳"] = { id: 148, name: '安阳', domain: 'anyang' };
arr2["品德装饰"] = { id: 149, name: '品德装饰', domain: 'pinde' };
arr2["邢台"] = { id: 150, name: '邢台', domain: 'xingtai' };
arr2["麻城"] = { id: 151, name: '麻城', domain: 'macheng' };
arr2["dsp"] = { id: 152, name: 'dsp', domain: 'dsp' };
arr2["保定"] = { id: 161, name: '保定', domain: 'bdqby' };
arr2["北京全包圆"] = { id: 162, name: '北京全包圆', domain: 'bjqby' };

/* 通用处理url*/
var aboutUrl = {
    getCurrentRequestValue: function (parameter) {
        var reg = new RegExp("(^|&)" + parameter + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r !== null) {
            return unescape(r[2]);
        }
        return null;
    },
    getCurrentRequestObject: function () {
        var url = location.search;
        var theRequest = new Object();
        if (url.indexOf("?") !== -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }
};

/* 通用处理cookie*/
var aboutCookie = {
    setCookie: function (name, value, hours) {
        var d = new Date();
        d.setTime(d.getTime() + hours * 3600 * 1000);
        document.cookie = name + '=' + value + '; expires=' + d.toGMTString();
    },
    getCookie: function (name) {
        var arr = document.cookie.split('; ');
        for (var i = 0; i < arr.length; i++) {
            var temp = arr[i].split('=');
            if (temp[0] === name) {
                return temp[1];
            }
        }
        return null;
    },
    removeCookie: function (name) {
        var d = new Date();
        d.setTime(d.getTime() - 10000);
        document.cookie = name + '=1; expires=' + d.toGMTString();
    }
};

/* 通用处理js原型扩展 */
String.prototype.isMobilePhoneNumber = function () {
    var isPhone = /^0\d{2,3}-?\d{7,8}$/;
    var isMob = /^1\d{10}$/;
    return isMob.test(this) || isPhone.test(this);
};
//房屋面积 1-999
String.prototype.isHouseArea = function () {
    var reg = new RegExp('^[1-9]{1}[0-9]{0,2}$');
    return reg.test(this);
};

/* 报名信息提交对象 */
var customer = {
    ms: null,
    bid: null,            //分公司Id
    fptid:null,
    name: null,           //客户名称
    phoneNumber: null,    //电话号码
    email: null,          //邮箱
    residentialName: null,//小区名
    squareMeters: null,   //建筑面积
    channel: null,        //了解渠道
    ck: null,             //渠道关键字
    url: null,            //url地址
    userId: null,         //关联推广员id
    remark: null          //备注
};

/* 报名信息提交对象及页面元素初始化，仅用于customer对象 */
var customerInit = {
    init: function () {
        customerInit.initDate();
        customerInit.initByUrl();
        customerInit.initByCookie();
        customerInit.initByLocation();
        customerInit.initElement();
    },
    //初始化日期
    initDate: function () {
        let month = new Date().getMonth() + 1;
        let lastDay;
        switch (month) {
            case 1:
            case 3:
            case 5:
            case 7:
            case 8:
            case 10:
            case 12:
                lastDay = 31;
                break;
            case 4:
            case 6:
            case 9:
            case 11:
                lastDay = 30;
                break;
            default:
                lastDay = 28;
                break;
        }
        $('#datestr,.datestr').html(month + '月1日-' + month + '月' + lastDay + '日');
    },

    //根据url初始化
    initByUrl: function () {
        //根据url参数处理bid及其他参数
        for (prop in customer) {
            customer[prop] = aboutUrl.getCurrentRequestValue(prop);
        }
        customer.url = window.location.href;

        //根据域名处理bid
        if (!customer.bid) {
            var index = customer.url.indexOf('yzf.com');
            if (index !== -1 && customer.url.indexOf('dsp')===-1) {
                var sub = customer.url.substring(0, index - 1).replace('https://', '').replace('http://', '');
                customer.bid = arr[sub].id;
            }
        }
        //根据bid处理要显示的城市名称
        if (customer.bid) {
            //如果bid不是数字 qd
            if (isNaN(customer.bid)) {
                for (prop in arr) {
                    if (prop === customer.bid) {
                        customer.bid = arr[prop].id;
                        $('.show-city').text(arr[prop].name);
                    }
                }
            } else {
                for (prop in arr) {
                    if (arr[prop].id.toString() === customer.bid) {
                        $('.show-city').text(arr[prop].name);
                    }
                }
            }
            
        }
        console.log('InitByUrl');
        console.log(customer);
    },

    //根据cookie初始化 ck和userId
    initByCookie: function () {
        if (!customer.ck) {
            customer.ck = aboutCookie.getCookie('ck');
        }
        if (!customer.userId) {
            customer.userId = aboutCookie.getCookie('userId');
        }
        console.log('initByCookie');
        console.log(customer);
    },

    //当bid为null时，根据百度定位初始化
    initByLocation() {
        if (!customer.bid) {
            var myCity = new BMap.Geolocation();
            myCity.getCurrentPosition(function (result) {
                if (this.getStatus() === BMAP_STATUS_SUCCESS) {
                    var citystr = result.address.city.replace('市', '');
                    var city = arr2[citystr];
                    if (city) {
                        customer.bid = city.id;
                        for (prop in arr) {
                            if (arr[prop].id === customer.bid) {
                                $('.show-city').text(arr[prop].name);
                            }
                        }

                    }
                    console.log('initByLocation');
                    console.log(result);
                    console.log(customer);

                }
            });
        }
    },

    //初始化元素
    initElement: function () {
        if (customer.ms === 'bdocpc' || customer.ck ==='bdpz-tpzq') {
            //百度ocpc模式代码
            console.log('load bdocpc');
            createScript_BaiduOCPC();
        }
        if (customer.ms === 'gdtocpc') {
            //广点通ocpc模式代码
        }
        //百度统计代码
        createScript_BaiduTongji();
        if ($("[name='branchId'],[name='BranchId']").val() === "29") {
            $("form").append("<p style='text-align: center;color: #fff;padding-top: 10px;'>最终解释权归业之峰所有</p>");
        }
    }
};

/* 表单提交，仅用于customer对象 */
$(".submit").click(function () {
    var $form = $(this).parent("form");
    var $elements = $form.find('input[type!="button"],textarea,select');
    $elements.each(function (index, element) {
        var name = $(element).attr('name');
        var val = $(element).val();
        if (customer.hasOwnProperty(name)) {
            customer[name] = val;
        }
    });
    
    //姓名非空验证
    var $inputName = $elements.filter('input[name="name"]');
    console.log($inputName.val())
    if ($inputName.length > 0 && $inputName.val() === '') {
        alert('请输入姓名');
        return;
    }
    //电话号码格式验证
    var $inputPhone = $elements.filter('input[name="phoneNumber"]');
    if ($inputPhone.length > 0 && !$inputPhone.val().isMobilePhoneNumber()) {
        alert('手机号码格式不正确');
        return;
    }
    //备注处理（几室几厅几卫）
    var $targetSel = $form.find('select[class*="remark"]');
    if ($targetSel.length > 0) {
        customer.remark = '';
        $targetSel.each(function (index,element) {
            customer.remark += $(element).val();
        });
    }
    console.log('ajax请求参数');
    console.log(customer);
    var urlHead = document.location.protocol === 'http:' ? 'http:' : 'https:';
    $.ajax({
        type: 'post',
        url: urlHead+'//admin.yzf.com.cn/api/RegistrationAPI/Insert',
        data: {
            'name': customer.name,
            'phoneNumber': customer.phoneNumber,
            'email': customer.email,
            'residentialName': customer.residentialName,
            'squareMeters': customer.squareMeters,
            'channel': customer.channel,
            'ck': customer.ck,
            'url': customer.url,
            'userId': customer.userId,
            'branchId': customer.bid,
            'adUserId': customer.fptid,
            'remark': customer.remark
        },
        success: function (json) {
            console.log('ajax返回结果');
            console.log(json);
            if (json.Sucess) {
                if (customer.ms === 'bdocpc' || customer.ck === 'bdpz-tpzq') {
                     window._agl && window._agl.push(['track', ['success', { t: 3 }]]);
                    //_hmt.push(['_trackEvent', 'Click', 'Order', 'success', 1]);
                }
                alert("恭喜您，报名成功");
            }
            else {
                alert("同一号码只能报名一次");
            }
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {
            alert(textStatus);
        }
    });
});

/* 追加百度统计代码到head */
function createScript_BaiduTongji() {
    if (typeof _hmt === "undefined") {
        let str = "    <script data-mk=\"pc信息流流量统计\">\n";
        str += "        var _hmt = _hmt || [];\n";
        str += "        (function () {\n";
        str += "            var hm = document.createElement(\"script\");\n";
        str += "            hm.src = \"https://hm.baidu.com/hm.js?cf4e7539fd6a59c1258ac97ea762b62f\";\n";
        str += "            var s = document.getElementsByTagName(\"script\")[0];\n";
        str += "            s.parentNode.insertBefore(hm, s);\n";
        str += "        })();\n";
        str += "    </script>\n";
        $('head').append(str);
    }
    
}

/* 追加百度ocpc代码到head */
function createScript_BaiduOCPC() {
    let str = "    <script>\n";
    str += "        window._agl = window._agl || [];\n";
    str += "        (function () {\n";
    str += "            _agl.push(\n";
    str += "                ['production', '_f7L2XwGXjyszb4d1e2oxPybgD']\n";
    str += "            );\n";
    str += "            (function () {\n";
    str += "                var agl = document.createElement('script');\n";
    str += "                agl.type = 'text/javascript';\n";
    str += "                agl.async = true;\n";
    str += "                agl.src = 'https://fxgate.baidu.com/angelia/fcagl.js?production=_f7L2XwGXjyszb4d1e2oxPybgD';\n";
    str += "                var s = document.getElementsByTagName('script')[0];\n";
    str += "                s.parentNode.insertBefore(agl, s);\n";
    str += "            })();\n";
    str += "        })();\n";
    str += "    </script>\n";
    $('head').append(str);
}

/*y页面初始化*/
customerInit.init();




